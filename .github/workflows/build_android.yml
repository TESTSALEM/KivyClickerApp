name: Kivy Android Build

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install System Dependencies ğŸ—ï¸
      run: |
        sudo apt update
        sudo apt install -y git zip unzip openjdk-17-jdk python3-pip autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libblas-dev liblapack-dev libssl-dev build-essential lld

    - name: Prepare Python Environment
      run: |
        pip install --upgrade pip setuptools wheel

    - name: Install Buildozer and Cython
      run: |
        pip install --upgrade buildozer cython 

    - name: Force Buildozer Clean (Mandatory Step) ğŸ§¹
      # Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ© ØªØ¬Ø¨Ø± Buildozer Ø¹Ù„Ù‰ Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´ ÙˆÙ‚Ø±Ø§Ø¡Ø© buildozer.spec Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
      run: |
        buildozer android clean

    - name: Initialize and Accept SDK Licenses ğŸ”‘
      # Ø§Ù„Ø¢Ù†ØŒ Ø³ÙŠÙ‚ÙˆÙ… Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ø¨ØªÙ†Ø²ÙŠÙ„ android.build_tools = 33.0.2 Ø§Ù„Ø°ÙŠ Ø­Ø¯Ø¯Ù†Ø§Ù‡ ÙÙŠ buildozer.spec
      run: |
        buildozer android update

    - name: Final Build Kivy App ğŸš€
      run: |
        buildozer android debug

    - name: Upload APK Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Android-APK-Release
        path: bin/*.apk
        
