name: Kivy Android Build

on:
  # ØªØ´ØºÙŠÙ„ Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù†Ø¯ Ø±ÙØ¹ (push) Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª Ø¥Ù„Ù‰ ÙØ±Ø¹ main
  push:
    branches: [ "main" ]
  # ØªØ´ØºÙŠÙ„ Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø³Ø­Ø¨ (Pull Request)
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    # Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø¨ÙŠØ¦Ø© Linux (Ubuntu)
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¥ØµØ¯Ø§Ø± Python 3.10
        python-version: '3.10'

    - name: Prepare Python Environment
      run: |
        # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø£Ø¯ÙˆØ§Øª Ø¨Ù†Ø§Ø¡ Python Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù„Ø­Ù…Ø§ÙŠØ© Cython)
        pip install --upgrade pip setuptools wheel

    - name: Install Buildozer and Cython
      run: |
        # ØªØ«Ø¨ÙŠØª Buildozer Ùˆ Cython Ù„Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        pip install --upgrade buildozer cython 

    - name: Initialize and Accept SDK Licenses ğŸ”‘
      # Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ© ØªØ«Ø¨Øª Ù…ÙƒÙˆÙ†Ø§Øª SDK/NDK ÙˆØªÙ‚Ø¨Ù„ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ù„Ù…Ù†Ø¹ Ø®Ø·Ø£ Aidl
      run: |
        buildozer android update

    - name: Final Build Kivy App ğŸš€
      # Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙØ¹Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ø¨ÙŠØ¦Ø©
      run: |
        buildozer android debug

    - name: Upload APK Artifact
      uses: actions/upload-artifact@v4
      with:
        # Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø­ÙØ¸Ù‡ Ø¹Ù„Ù‰ GitHub
        name: Android-APK-Release
        # Ù…Ø³Ø§Ø± Ù…Ù„Ù APK Ø§Ù„Ù†Ø§ØªØ¬
        path: bin/*.apk
